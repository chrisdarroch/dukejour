<%
  mdl = 'track'
  create_entry = jquery_xhr :create, Entry,
    :params => "'entry[track_id]': track_id",
    :callback => %Q(
      $('#queue ul.entries').append(data)
        .children(':last').hide()
        .show('blind', {direction: 'vertical'}, 500);
    )
%>

function selectSearchResult() {
  var record, record_email;

  track_id = parseInt($(this).find('.track_id').html());

  if (0 < track_id) {
    <%= create_entry %>;

    jQuery('#suggest_<%= mdl %>')
      .val('')
      .focus();
  }
}

jQuery(function() {

  // Prevent submits
  jQuery("form:first").submit(function() { return false; });

  // When an entry in the completion list is ENTERinated, AJAX load the corresponding record
  jQuery("#suggest_<%= mdl %>")
    .keypress(function(e) {
      key = e.which;
      if ((KEYS.RETURN == key) || (KEYS.ENTER == key) || (KEYS.TAB == key)) {
        selectSearchResult();
      }
    });

  // Hook the suggestion code to the text field
  jQuery("#suggest_<%= mdl %>")
    .focus()
    .suggest("<%= suggest_tracks_path :fields => 'artist,album,name', :limit => 25 %>", { })
    .ajaxSuccess(function() {
      // Apply a click hook to each search result
      jQuery('.ac_results li').click(selectSearchResult);
    });
});

<%= javascript_for_ajax_response %>
